<%- include("../partials/user/header.ejs") %>
  <style>
    .filter-section {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }

    .sort-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sort-label {
      font-size: 1em;
      font-weight: bold;
      color: #333;
    }

    .sort-dropdown {
      padding: 10px 15px;
      font-size: 1em;
      font-weight: 500;
      color: #555;
      background-color: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 8px;
      outline: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .sort-dropdown:hover {
      border-color: #888;
    }

    .sort-dropdown:focus {
      border-color: #555;
      box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.2);
    }

    .sort-dropdown option {
      padding: 10px;
      background-color: #f0f0f0;
      color: #333;
    }
  </style>

  <main class="main">
    <section class="home-slider position-relative pt-50">
      <div class="col-lg-12 col-md-6" style="padding: 0px 100px;">
        <div class="single-slider-img single-slider-img-1">
          <% if(locals.user){%>
            <img class="animated slider-1-1" src="/uploads/banner/b2.jpg" alt="banner">
            <% }else{%>
              <img class="animated slider-1-1" src="/uploads/banner/b5.jpg" alt="banner">
              <% } %>
        </div>
      </div>
    </section>
    

    <section class="art-gallery-section">
      <section class="filter-section">
        <div class="container">
          <div class="sort-container">
            <label for="sortOptions" class="sort-label">Sort By:</label>
            <select id="sortOptions" class="sort-dropdown">
              <option value="">Select</option>
              <option value="az">Name: A to Z</option>
              <option value="za">Name: Z to A</option>
              <option value="priceLow">Price: Low to High</option>
              <option value="priceHigh">Price: High to Low</option>
              <option value="popularity">Popularity</option>
            </select>
          </div>
        </div>
      </section>
      <div class="container">
        <div class="art-grid">
          <% if (products && products.length> 0) { %>
            <% products.forEach(product=> { %>
              <div class="art-card">
                <a href="/productDetails?id=<%= product._id %>" class="product-link">
                  <div class="art-image">
                    <% if (product.productImage && product.productImage.length> 0) { %>
                      <img src="/uploads/re-image/<%= product.productImage[0] %>" alt="<%= product.productName %>">
                      <% } else { %>
                        <img src="/path/to/placeholder-image.jpg" alt="No image available">
                        <% } %>
                          <div class="overlay">
                            <div class="action-buttons">
                              <!-- <button class="wishlist-btn" onclick="event.preventDefault(); window.location.href='/addToWhishList?id=<%= product._id %>'">
                                <i class="fi-rs-heart"></i>
                              </button> -->
                              <button class="cart-btn"
                                onclick="event.preventDefault(); window.location.href='/addCart?productId=<%= product._id %>&quantity=<%= 1%>'">
                                <i class="fi-rs-shopping-bag-add"></i>
                              </button>
                            </div>
                          </div>
                  </div>
                  <div class="art-details">
                    <span class="category">
                      <%= product.category.name %>
                    </span>
                    <h3 class="title">
                      <%= product.productName %>
                    </h3>
                    <div class="price-tag">
                      <span class="current-price">₹<%= product.salePrice %></span>
                      <% if (product.regularPrice && product.regularPrice> product.salePrice) { %>
                        <span class="original-price">₹<%= product.regularPrice %></span>
                        <span class="discount">-<%= Math.round(((product.regularPrice - product.salePrice) /
                            product.regularPrice) * 100) %>%</span>
                        <% } %>
                    </div>
                  </div>
                </a>
              </div>
              <% }); %>
                <% } else { %>
                  <div class="no-products">
                    <p>No artworks available</p>
                  </div>
                  <% } %>
        </div>
      </div>
    </section>

  </main>
  <script>
    document.getElementById("sortOptions").addEventListener("change", async function () {
      const selectedOption = this.value;
      console.log(selectedOption)
      try {
        const response = await fetch(`/getProducts?sort=${selectedOption}`, {
          headers: { "Accept": "application/json" }
        });
        const data = await response.json();
        console.log(data)
        if (response.ok) {
          renderProducts(data.products);
        } else {
          console.error("Error fetching sorted products:", data.message);
        }
      } catch (error) {
        console.error("Fetch error:", error);
      }
    });

    function renderProducts(products) {
      const artGrid = document.querySelector(".art-grid");
      artGrid.innerHTML = "";

      products.forEach(product => {
        const productHTML = `
                  <div class="art-card">
                      <a href="/productDetails?id=${product._id}" class="product-link">
                          <div class="art-image">
                              <img src="/uploads/re-image/${product.productImage[0] || 'placeholder.jpg'}" alt="${product.productName}">
                              <div class="overlay">
                                  <div class="action-buttons">
                                      <button class="cart-btn" onclick="event.preventDefault(); window.location.href='/addCart?productId=${product._id}&quantity=1'">
                                          <i class="fi-rs-shopping-bag-add"></i>
                                      </button>
                                  </div>
                              </div>
                          </div>
                          <div class="art-details">
                              
                              <h3 class="title">${product.productName}</h3>
                              <div class="price-tag">
                                  <span class="current-price">₹${product.salePrice}</span>
                                  ${product.regularPrice > product.salePrice ? `<span class="original-price">₹${product.regularPrice}</span>
                                  <span class="discount">-${Math.round(((product.regularPrice - product.salePrice) / product.regularPrice) * 100)}%</span>` : ""}
                              </div>
                          </div>
                      </a>
                  </div>
              `;
        artGrid.insertAdjacentHTML("beforeend", productHTML);
      });
    }
  </script>


  <style>
    .art-gallery-section {
      padding: 50px 0;
      background-color: #f8f9fa;
    }

    .art-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 30px;
      padding: 20px;
    }

    .art-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      position: relative;
    }

    .art-card:hover {
      transform: translateY(-5px);
    }

    .art-image {
      position: relative;
      padding-top: 100%;
    }

    .art-image img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      opacity: 0;
      transition: opacity 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .art-card:hover .overlay {
      opacity: 1;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
    }

    .action-buttons button {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      border: none;
      background: white;
      color: #333;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .action-buttons button:hover {
      background: #333;
      color: white;
    }

    .art-details {
      padding: 20px;
    }

    .category {
      color: #666;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .title {
      margin: 10px 0;
      font-size: 1.2em;
      color: #333;
    }

    .price-tag {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .current-price {
      font-size: 1.3em;
      font-weight: bold;
      color: #333;
    }

    .original-price {
      text-decoration: line-through;
      color: #999;
    }

    .discount {
      background: #ff4444;
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.8em;
    }

    @media (max-width: 768px) {
      .art-grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
      }
    }

    .product-link {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .product-link:hover {
      text-decoration: none;
      color: inherit;
    }
  </style>
  <%- include("../partials/user/footer.ejs") %>