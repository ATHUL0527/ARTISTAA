<%- include('../partials/user/header') %>

<style>
    /* General Styles */
    body {
        font-family: 'Arial', sans-serif;
        background-color: #f9f9f9;
        color: #333;
    }

    .page-header {
        background: linear-gradient(to right, #d1d3d3, #39b4ac);
        color: #fff;
        padding: 20px 0;
        text-align: center;
    }

    .breadcrumb a {
        color: #fff;
        text-decoration: none;
    }

    .breadcrumb span {
        color: #fff;
        margin: 0 5px;
    }

    .main {
        padding: 50px 0;
    }

    h4 {
        margin-bottom: 20px;
        font-size: 24px;
        color: #000000;
    }

    .card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        transition: box-shadow 0.3s;
    }

    .card:hover {
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
    }

    .form-check-input {
        margin-top: 0.3rem;
    }

    .order_review {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }

    .payment_option {
        display: flex;
        flex-direction: column;
    }

    .custome-radio {
        margin-bottom: 15px;
    }

    .btn-fill-out {
        background-color: #39b4ac;
        color: #fff;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .btn-fill-out:hover {
        background-color: #39b4ac;
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
        .row {
            flex-direction: column;
        }

        .col-md-6 {
            width: 100%;
        }
    }
</style>

<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="/" rel="nofollow">Home</a>
                <span></span> Shop
                <span></span> Checkout
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <!-- Address Selection -->
                    <h4>Select Your Address</h4>
                    <% if (addresses.length > 0) { %>
                        <% addresses.forEach((addr, i) => { %>
                            <div class="card">
                                <input type="radio" name="selectedAddress" id="address-<%= i %>"
                                    value="<%= JSON.stringify(addr) %>" required
                                    onchange="document.getElementById('address').value = '<%= addr._id %>';">
                                <label for="address-<%= i %>">
                                    <div class="card-body">
                                        <strong><%= addr.addressType %></strong><br>
                                        <%= addr.name %><br>
                                        <%= addr.streetAddress %><br>
                                        <%= addr.city %>, <%= addr.state %><br>
                                        <%= addr.pincode %><br>
                                        <%= addr.phone %>
                                        <% if (addr.altPhone) { %>&nbsp; | &nbsp;<%= addr.altPhone %><% } %>
                                    </div>
                                </label>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <p>No addresses available.</p>
                    <% } %>
                </div>

                <div class="col-md-6">
                    <div class="order_review">
                        <h4>Your Orders</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th colspan="2">Product</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (product) { %>
                                    <tr>
                                        <td class="image product-thumbnail">
                                            <img src="/uploads/re-image/<%= product.productImage[0] %>" alt="<%= product.productName %>">
                                        </td>
                                        <td>
                                            <h5><%= product.productName %></h5>
                                            <span>Units: 1</span>
                                        </td>
                                        <td><%= product.salePrice.toLocaleString() %></td>
                                    </tr>
                                    <tr>
                                        <th>SubTotal</th>
                                        <td colspan="2"><%= totalPrice.toLocaleString() %></td>
                                    </tr>
                                <% } else if (cart && cart.items.length > 0) { %>
                                    <% cart.items.forEach(item => { %>
                                        <tr>
                                            <td class="image product-thumbnail">
                                                <img src="/uploads/re-image/<%= item.productId.productImage[0] %>" alt="<%= item.productId.productName %>">
                                            </td>
                                            <td>
                                                <h5><%= item.productId.productName %></h5>
                                                <span>Units: <%= item.quantity %></span>
                                            </td>
                                            <td><%= item.totalPrice.toLocaleString() %></td>
                                        </tr>
                                    <% }); %>
                                    <tr>
                                        <th>SubTotal</th>
                                        <td colspan="2"><%= totalPrice.toLocaleString() %></td>
                                    </tr>
                                <% } else { %>
                                    <tr>
                                        <td colspan="3">No items in cart or product selection.</td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>

                        <form id="orderForm" method="POST" action="/place-order" onsubmit="return validateAddress()">
                            <div>
                                <h4>Select Payment Method</h4><br>
                                <div class="payment_option">
                                    <div class="custome-radio">
                                        <input class="form-check-input" required type="radio" name="payment_option" id="exampleRadios3" value="COD">
                                        <label class="form-check-label" for="exampleRadios3">COD</label>
                                    </div>
                                    <div class="custome-radio">
                                        <input class="form-check-input" required type="radio" name="payment_option" id="exampleRadios5" value="Paypal">
                                        <label class="form-check-label" for="exampleRadios5">Paypal</label>
                                    </div>
                                </div>
                                
                            </div>

                            <input type="hidden" name="cart" value='<%= JSON.stringify(cart ? cart.items : []) %>'>
                            <input type="hidden" name="totalPrice" value="<%= totalPrice %>">
                            <% if (product) { %>
                                <input type="hidden" name="singleProduct" value="<%= JSON.stringify(product) %>">
                            <% } %>
                            <input type="hidden" name="address" id="address">
                            <button type="submit" class="btn btn-fill-out btn-block mt-30">Place Order</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<%- include('../partials/user/footer') %>

<script>
    function validateAddress() {
        const addressRadioButtons = document.querySelectorAll('input[name="selectedAddress"]');
        let addressSelected = false;

        addressRadioButtons.forEach((radio) => {
            if (radio.checked) {
                addressSelected = true;
            }
        });

        if (!addressSelected) {
            Swal.fire({
                icon: 'warning',
                title: 'Address Required',
                text: 'Please select an address before proceeding.',
                confirmButtonText: 'Okay',
                confirmButtonColor: '#007bff',
                backdrop: true,
            });
            return false;
        }
        return true;
    }
</script>